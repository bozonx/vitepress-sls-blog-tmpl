# Улучшения RSS форматов

## Обзор изменений

Реализована поддержка настройки форматов RSS через конфигурацию `rssFormats` в `themeConfig`.

## Что было изменено

### 1. Создан общий модуль `src/page-helpers/rssFormats.js`

Новый модуль содержит:

- `getFormatInfo(format)` - возвращает информацию о формате RSS (MIME-тип, заголовок, расширение файла, генератор)
- `getRssFormats(config)` - получает настройки форматов из конфигурации

### 2. Обновлен `src/page-helpers/generateRssFeed.js`

- Удален TODO комментарий
- Добавлен импорт функций из `rssFormats.js`
- Заменена жестко заданная генерация всех форматов на динамическую генерацию только настроенных форматов
- Улучшена обработка ошибок для каждого формата отдельно

### 3. Обновлен `src/page-helpers/addRssLinks.js`

- Добавлен импорт функций из `rssFormats.js`
- Используется общая функция `getRssFormats()` вместо дублирования логики
- Удалена дублированная функция `getFormatInfo()`

## Конфигурация

В `themeConfig` можно настроить форматы RSS:

```javascript
themeConfig: {
  rssFormats: ['rss', 'atom', 'json'], // По умолчанию
  // или только нужные форматы:
  rssFormats: ['rss', 'json'], // Только RSS и JSON
  rssFormats: ['rss'], // Только RSS
}
```

## Поддерживаемые форматы

- `rss` - RSS 2.0 (application/rss+xml)
- `atom` - Atom 1.0 (application/atom+xml)
- `json` - JSON Feed 1.1 (application/feed+json)

## Преимущества

1. **Гибкость**: Можно включать/отключать форматы через конфигурацию
2. **Производительность**: Генерируются только нужные форматы
3. **Консистентность**: Единая логика работы с форматами во всех модулях
4. **Расширяемость**: Легко добавить новые форматы в будущем
5. **Обработка ошибок**: Улучшена обработка ошибок для каждого формата

## Обратная совместимость

Все изменения обратно совместимы. Если `rssFormats` не указан в конфигурации, используются все три формата по умолчанию: `['rss', 'atom', 'json']`.

## Исправления критических ошибок

### Проблема с пустыми RSS feeds

**Проблема**: RSS feeds генерировались пустыми (без постов).

**Причина**: Критическая ошибка в логике сортировки и ограничения постов в `generateRssFeed.js`. Методы `sort()` и `slice()` применялись к массиву `posts`, но результат не присваивался обратно переменной, что приводило к обработке исходного несортированного массива.

**Решение**:

```javascript
// БЫЛО (неправильно):
posts
  .sort((a, b) => +new Date(b.frontmatter.date) - +new Date(a.frontmatter.date))
  .slice(0, config.userConfig.themeConfig.maxPostsInRssFeed)

for (const { url, frontmatter, src } of posts) { // Использовался исходный массив!

// СТАЛО (правильно):
const sortedPosts = posts
  .sort((a, b) => +new Date(b.frontmatter.date) - +new Date(a.frontmatter.date))
  .slice(0, config.userConfig.themeConfig.maxPostsInRssFeed)

for (const { url, frontmatter, src } of sortedPosts) { // Используется отсортированный массив
```

### Улучшения обработки ошибок

- Добавлена безопасная обработка авторов в `makeAuthorForRss()`
- Добавлена отладочная информация для диагностики проблем (только в debug режиме)
- Улучшена валидация конфигурации авторов
- Реализован debug режим для контроля вывода логов

### Debug режим

Добавлена поддержка debug режима для контроля вывода отладочной информации:

```javascript
// Включение debug режима через userConfig
export default defineConfig({
  userConfig: {
    debug: true,
    // ... остальная конфигурация
  }
})

// Или через themeConfig
export default defineConfig({
  themeConfig: {
    debug: true,
    // ... остальная конфигурация
  }
})

// Или автоматически в development режиме
NODE_ENV=development
```

**Функции debug режима:**

- `isDebugMode(config)` - проверяет, включен ли debug режим
- `debugLog(config, message, ...args)` - выводит сообщение только в debug режиме

**Отладочная информация включает:**

- Количество найденных постов для каждой локали
- Процесс обработки постов
- Информацию о валидации постов
- Детали извлечения описаний
- Количество постов в финальном feed
